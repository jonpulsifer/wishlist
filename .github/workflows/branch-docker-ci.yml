name: docker build
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Build docker image
      env:
        RAILS_ENV: production
      run: |
        docker build -t jonpulsifer/wishlist-rails:${{ github.sha }} .
    # This is producing false positives, disable for now
    # - name: Container security scan
    #   uses: Azure/container-scan@v0
    #   with:
    #     image-name: jonpulsifer/wishlist-rails:${{ github.sha }}
  tests:
    name: rubocop
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: actions/setup-ruby@v1
        with:
          ruby-version: 2.7.2
      - name: install dependencies
        run: |
          gem install bundler --no-rdoc --no-ri
          bundle install
      - name: style
        run: bundle exec rubocop
      - name: type check
        run: bundle exec srb tc
